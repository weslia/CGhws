<!DOCTYPE html>
<html>
<head>
<style>
#info {
  position: absolute;
  top: 2%;
  width: 100%;
  padding: 10px;
  text-align: center;
  color: #ffff00
}

body {
  overflow: hidden;
}
</style>
</head>

<body>

<div id="info">HW1: Simple Stopwatch 
  <br><br>
  <button id="toggle" style="width:20%">Start</button>
  <button id="type" style="width:20%">analog</button><br><br>
  <button id="onedown" style="width:10%">-1</button>
  <button id="oneup" style="width:10%">+1</button><br>
  <button id="tendown" style="width:10%">-10</button>
  <button id="tenup" style="width:10%">+10</button><br>
  <button id="reset" style="width:20%">reset</button>
</div>
<audio id="clockSound" style="display:none">
  <source src="clockSound.mp3" type='audio/mp3'>
</audio>

<script src="https://threejs.org/build/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

<script>
var camera, scene, renderer;
var frame,ScaleGroup= new THREE.Group(), sun = new THREE.Group(), moon = new THREE.Group();
var second = new THREE.Group(), SecondCircle; 
var clock, clockSound, secondAngle=0, secondCircleAngle=0;
var isActive = false, clockNum = 2;

$("#toggle").click(function() {
  isActive = ! isActive;
});
$("#type").click(function() {
  if(clockNum ==0){
  	clockNum = 1;
    $('#type').html('sector');
  }
  else if(clockNum ==1){
  	clockNum = 2;
    $('#type').html('analog');
  }
  else if(clockNum ==2){
  	clockNum = 0;
    $('#type').html('quartz');
  }
  setClockType();	
});
$("#oneup").click(function() {
  secondAngle += 1/30*Math.PI;
  secondCircleAngle += 1/30*Math.PI;
  handleOverflow();
  setSecondNeedle();
  setSecondCircle();
  setClockType();
});
$("#onedown").click(function() {
  secondAngle -= 1/30*Math.PI;
  secondCircleAngle -= 1/30*Math.PI;
  handleOverflow();
  setSecondNeedle();
  setSecondCircle();
  setClockType();
});
$("#tenup").click(function() {
  secondAngle += 1/3*Math.PI;
  secondCircleAngle += 1/3*Math.PI;
  handleOverflow();
  setSecondNeedle();
  setSecondCircle();
  setClockType();
});
$("#tendown").click(function() {
  secondAngle -= 1/3*Math.PI;
  secondCircleAngle -= 1/3*Math.PI;
  handleOverflow();
  setSecondNeedle();
  setSecondCircle();
  setClockType();
});
$("#reset").click(function() {
  secondAngle = 0;
  secondCircleAngle = 0;
  setSecondNeedle();
  setSecondCircle();
  setClockType();
});
init();
animate();

function init() {
  renderer = new THREE.WebGLRenderer();
  document.body.appendChild (renderer.domElement);
  var width = window.innerWidth;
  var height = window.innerHeight;
  renderer.setSize (width, height);
  renderer.setClearColor('#888888');

  scene = new THREE.Scene();
  
  camera = new THREE.PerspectiveCamera (100, width/height, 1, 500);
  camera.position.set(0,0,50);
  camera.lookAt (new THREE.Vector3(0,0,0));
  //camera = new THREE.OrthographicCamera(-50, 50, 50, -50, -10, 100);
  //camera.position.z = 10;
  
  window.addEventListener('resize', onWindowResize, true);
  //clock sound
  clockSound = document.getElementById ('clockSound'); 

  // clock frame
  frame = new THREE.Mesh (new THREE.CircleGeometry (30,60,0,Math.PI), new THREE.MeshBasicMaterial({color:'Lightcyan'}));
  frame.position.set(0,0,0);
  scene.add(frame);
  frame2 = new THREE.Mesh (new THREE.CircleGeometry (31,60), new THREE.MeshBasicMaterial({color:'black'}));
  frame2.position.set(0,0,-1);
  scene.add(frame2);
  frame3 = new THREE.Mesh (new THREE.CircleGeometry (33,60), new THREE.MeshBasicMaterial({color:'white'}));
  frame3.position.set(0,0,-2);
  scene.add(frame3);

  for(var i=1; i<6; i++){
    var Scale = new THREE.Mesh (new THREE.CircleGeometry (1.5,60), new THREE.MeshBasicMaterial({color:'black'}));
    Scale.position.set(30*Math.cos(Math.PI*i/6),30*Math.sin(Math.PI*i/6),0);
    ScaleGroup.add(Scale);
    scene.add(ScaleGroup);
  }
  for(var i=-1; i>-6; i--){
    var Scale = new THREE.Mesh (new THREE.CircleGeometry (1.5,60), new THREE.MeshBasicMaterial({color:'gray'}));
    Scale.position.set(30*Math.cos(Math.PI*i/6),30*Math.sin(Math.PI*i/6),0);
    ScaleGroup.add(Scale);
    scene.add(ScaleGroup);
  }
  
  var goalLine = new THREE.Mesh (new THREE.CylinderGeometry ( 0.1, 0.1, 30, 80 ), new THREE.MeshBasicMaterial({color:'black'}));
  goalLine.position.set(0,15,0);
  scene.add(goalLine);
  var centerAxis = new THREE.Mesh (new THREE.CylinderGeometry ( 2, 2, 1, 80 ), new THREE.MeshBasicMaterial({color:'brown'}));
  centerAxis.rotation.x = Math.PI/2;
  centerAxis.position.set(0,0,2);
  scene.add(centerAxis);
    // sector & quartz
  SecPin = new THREE.Mesh (new THREE.ConeGeometry( 2, 28, 3 ), new THREE.MeshBasicMaterial({color:'red'}));
  SecPin.position.set(0,14,0);
  second.add(SecPin);
  second.position.set(0,0,0);
  
  var sunPart = new THREE.Mesh (new THREE.CircleGeometry (1.8,60), new THREE.MeshBasicMaterial({color:'#F0371F'}));
  var sunPart2 = new THREE.Mesh (new THREE.CircleGeometry (3,4), new THREE.MeshBasicMaterial({color:'#F0A510'}));
  var sunPart3 = new THREE.Mesh (new THREE.CircleGeometry (3,4), new THREE.MeshBasicMaterial({color:'#F0A510'}));
  sunPart2.position.set(0,0,-0.01);
  sunPart3.position.set(0,0,-0.01);
  sunPart2.rotation.z = Math.PI/4;
  sun.add(sunPart,sunPart2,sunPart3);
  sun.position.set(SecPin.position.x,SecPin.position.y+4,SecPin.position.z+5);
  second.add(sun);

  var moonPart = new THREE.Mesh (new THREE.CircleGeometry (2.5,60), new THREE.MeshBasicMaterial({color:'#F0D010'}));
  var moonPart2 = new THREE.Mesh (new THREE.CircleGeometry (2,60), new THREE.MeshBasicMaterial({color:'black'}));
  moonPart.position.set(0,0,-0.01);
  moonPart2.position.set(0.5,0,0);
  moon.add(moonPart,moonPart2);
  moon.position.set(SecPin.position.x,SecPin.position.y+4,SecPin.position.z+5);
  second.add(moon);

  scene.add(second);
  // analog
  SecondCircle= new THREE.Mesh (new THREE.CircleGeometry (27,60,0,0), new THREE.MeshBasicMaterial({color:'pink', side: THREE.DoubleSide}));
  SecondCircle.position.set(0,0,0);
  SecondCircle.visible = false;
  scene.add(SecondCircle);
  setClockType(); 
  // time
  clock = new THREE.Clock();
  setTimeout(runClock,0);
  //window.addEventListener('mousedown', onDocumentMouseDown, false);
}

function runClock() {
  var secPass = clock.getDelta();
  if(clockNum==0){
    if(isActive){
      secondAngle -= secPass*1/30*Math.PI;
      secondCircleAngle -= secPass*1/30*Math.PI;
    }
    setTimeout(runClock,0);
  }else if(clockNum==1){
    if(isActive){
      secondAngle -= 1/30*Math.PI;
      secondCircleAngle -= 1/30*Math.PI;
    }
    setTimeout(runClock,1000);
  }else if(clockNum==2){
    if(isActive){
      secondAngle -= secPass*1/30*Math.PI;
      secondCircleAngle -= secPass*1/30*Math.PI;
    }
    setTimeout(runClock,0);
  } 
}

function animate() {
  requestAnimationFrame(animate);
  render();
  if(isActive){
    if(secondCircleAngle <= 0 && isActive == true){
      handleOverflow();
      isActive = false;
      clockSound.play();
      //secondCircleAngle-=Math.PI*2;
    }   	
    setSecondNeedle();
    setSecondCircle();
    setClockType();
  }
  if(isActive){
    $('#toggle').html('Stop');
  }else{
    $('#toggle').html('Start');
  }
}

function handleOverflow() {
  if(secondAngle > 2*Math.PI) secondAngle = 2*Math.PI;
  if(secondAngle < 0) secondAngle = 0;
  if(secondCircleAngle > 2*Math.PI) secondCircleAngle = 2*Math.PI;
  if(secondCircleAngle < 0) secondCircleAngle = 0;
}
function setSecondNeedle() {
  second.rotation.z = secondAngle;
  sun.rotation.z = -secondAngle;
  moon.rotation.z = -secondAngle;
}
function setSecondCircle() {
  scene.remove(SecondCircle);
  SecondCircle = new THREE.Mesh (new THREE.CircleGeometry (27,60,Math.PI/2,-secondCircleAngle), new THREE.MeshBasicMaterial({color:'pink', side: THREE.DoubleSide}));
  SecondCircle.rotation.y = Math.PI;
  SecondCircle.position.set(0,0,0);
  scene.add(SecondCircle);
}
function setClockType() { 
  if(clockNum==0 || clockNum==1){
    second.visible = true;
    if(secondCircleAngle<Math.PI/2 || secondCircleAngle>Math.PI*3/2){
        sun.visible = true;
        moon.visible = false;
    }else{
        sun.visible = false;
        moon.visible = true;
    }
    SecondCircle.visible = false;
  }
  else if(clockNum==2){
    second.visible = false;
    SecondCircle.visible = true;
  }
}
function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function render() {
  renderer.render(scene, camera);
}
</script>
</body>

</html>
